{% extends 'layout_panel.html' %}
{% load static %}

{% block title %}Consultar Clientes - ZuluAris CRM{% endblock %}

{% block content %}
<div class="card">
    <h2>Consultar Clientes</h2>

    <!-- üîç Buscador -->
    <form class="filters" method="get" action="">
        <input 
            type="text" 
            name="q" 
            value="{{ query }}" 
            placeholder="Buscar por nombre o DNI"
        >
        <button type="submit">üîç Buscar</button>
    </form>

    <!-- Tabla de resultados -->
    <table>
        <thead>
            <tr>
                <th>DNI</th>
                <th>Cliente</th>
                <th>Correo</th>
                <th>Producto</th>
                <th>Vigencia</th>
            </tr>
        </thead>
        <tbody>
            {% if datos_clientes %}
                {% for item in datos_clientes %}
                <tr>
                    <td>{{ item.cliente.dni }}</td>
                    <td>
                        <a href="{% url 'detalle_cliente' item.cliente.dni %}" class="cliente-link">
                            {{ item.cliente.nombre }}
                        </a>
                    </td>
                    <td>{{ item.cliente.correo|default:"-" }}</td>
                    

                    <!-- Producto -->
                    <td>
                        {% if item.poliza %}
                            {{ item.poliza.id_producto.descripcion }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <!-- Vigencia -->
                    <td>
                        {% if item.poliza %}
                            {{ item.poliza.fecha_inicio }} ‚Üí {{ item.poliza.fecha_fin }}
                        {% else %}
                            Sin p√≥liza
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" style="text-align:center;">No hay clientes registrados.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}