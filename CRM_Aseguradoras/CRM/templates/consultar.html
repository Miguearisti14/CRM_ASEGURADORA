{% extends 'layout_panel.html' %}
{% load static %}

{% block title %}Consultar Clientes - ZuluAris CRM{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Consultar Clientes</h2>
    </div>

    <!-- ðŸ” Buscador -->
    <form class="consulta-filtros" method="get" action="">
            <div class="grupo-busqueda">
                <input 
                    type="text" 
                    name="q" 
                    value="{{ query }}" 
                    placeholder="Buscar por nombre o DNI..."
                    class="input-busqueda"
                >

                <select name="producto" class="input-select">
                    <option value="">Producto</option>
                    {% for producto in productos %}
                        <option value="{{ producto.id }}" {% if producto.id|stringformat:"s" == request.GET.producto %}selected{% endif %}>
                            {{ producto.descripcion }}
                        </option>
                    {% endfor %}
                </select>

                <button type="submit" class="btn-buscar">Buscar</button>
                    <a href="{% url 'consultar_clientes' %}" class="btn-limpiar">Limpiar filtro</a>

            </div>
        </form>

    <!-- Tabla de resultados -->
    <table>
        <thead>
            <tr>
                <th>DNI</th>
                <th>Cliente</th>
                <th>Correo</th>
                <th>Producto</th>
                <th>Vigencia</th>
            </tr>
        </thead>
        <tbody>
            {% if datos_clientes %}
                {% for item in datos_clientes %}
                <tr>
                    <td>{{ item.cliente.dni }}</td>
                    <td>
                        <a href="{% url 'detalle_cliente' item.cliente.dni %}" class="cliente-link">
                            {{ item.cliente.nombre }}
                        </a>
                    </td>
                    <td>{{ item.cliente.correo|default:"-" }}</td>
                    

                    <!-- Producto -->
                    <td>
                        {% if item.poliza %}
                            <a href="{% url 'detalle_poliza' item.cliente.dni %}" class="cliente-link">
                                {{ item.poliza.id_producto.descripcion }}
                            </a>
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    

                    <!-- Vigencia -->
                    <td>
                        {% if item.poliza %}
                            {{ item.poliza.fecha_inicio }} â†’ {{ item.poliza.fecha_fin }}
                        {% else %}
                            Sin pÃ³liza
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" style="text-align:center;">No hay clientes registrados.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}